# ü§ñ ADK Memory - Sistema de Agentes con Memoria Persistente

Sistema completo de agentes de IA con memoria persistente usando Google's Agent Development Kit (ADK) y Vertex AI.

## üìã Caracter√≠sticas Principales

- **üß† Memoria Persistente**: Los agentes recuerdan conversaciones anteriores entre sesiones
- **‚òÅÔ∏è M√∫ltiples Backends**: Soporte para SQLite local, ADK InMemory y Vertex AI Memory Bank
- **üåê API REST**: Servidor FastAPI con interfaz web intuitiva
- **üîß Herramientas ADK**: Integraci√≥n completa con herramientas oficiales del ADK
- **üîê Autenticaci√≥n Flexible**: Soporte para API Keys y OAuth2

## üöÄ Agentes Disponibles

### 1. **Database Agent** (SQLite) - ‚≠ê F√ÅCIL
**Memoria local completa con base de datos SQLite**

**Caracter√≠sticas:**
- üóÑÔ∏è Base de datos SQLite integral con m√∫ltiples tablas
- üìä B√∫squeda sem√°ntica b√°sica por palabras clave
- üíæ Memoria persistente local (no se pierde al reiniciar)
- üìù Historial completo de conversaciones
- üîç Contexto sem√°ntico personalizado
- üõ†Ô∏è Herramienta `load_memory` integrada autom√°ticamente

**Configuraci√≥n:**
- Solo requiere API Key de Google AI Studio
- No necesita Google Cloud SDK
- Ideal para desarrollo y pruebas locales

**Uso:**
```bash
python start_web.py --agent database
```

### 2. **ADK Agent** (ADK InMemory) - ‚≠ê‚≠ê INTERMEDIO
**Implementaci√≥n oficial del patr√≥n ADK con servicios InMemory**

**Caracter√≠sticas:**
- üîß InMemorySessionService para gesti√≥n de sesiones
- üß† InMemoryMemoryService para memoria persistente
- üîç B√∫squeda autom√°tica en conversaciones pasadas
- üìã Gesti√≥n de sesiones siguiendo patr√≥n oficial ADK
- üõ†Ô∏è Herramienta `load_memory` integrada autom√°ticamente
- ‚úÖ Implementaci√≥n 100% compatible con documentaci√≥n oficial

**Configuraci√≥n:**
- Requiere API Key de Google AI Studio
- No necesita Google Cloud SDK
- Recomendado para desarrollo y pruebas

**Uso:**
```bash
python start_web.py --agent adk
```

### 3. **Vertex Agent** (Vertex AI Memory Bank) - ‚≠ê‚≠ê‚≠ê AVANZADO
**Memoria persistente en Google Cloud con b√∫squeda sem√°ntica avanzada**

**Caracter√≠sticas:**
- ‚òÅÔ∏è VertexAiMemoryBankService para memoria en la nube
- üß† B√∫squeda sem√°ntica avanzada con IA
- üíæ Memoria persistente escalable en Google Cloud
- üîÑ Procesamiento autom√°tico de memoria
- üìä Extracci√≥n inteligente de informaci√≥n
- üîê Autenticaci√≥n OAuth2 segura

**Configuraci√≥n:**
- Requiere Google Cloud SDK instalado
- Necesita proyecto de Google Cloud configurado
- Requiere Agent Engine creado
- Recomendado para producci√≥n

**Uso:**
```bash
python start_web.py --agent vertex
```

## üõ†Ô∏è Instalaci√≥n R√°pida

### Prerrequisitos

```bash
# Python 3.8+ (requerido)
python --version

# Google Cloud SDK (solo para Vertex Agent)
gcloud --version  # Opcional
```

### 1. Configuraci√≥n B√°sica

```bash
# Clonar repositorio
git clone <tu-repositorio>
cd ADK_memory

# Crear entorno virtual
python -m venv venv

# Activar entorno virtual
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# Instalar dependencias
pip install -r requirements.txt
```

### 2. Configuraci√≥n de Variables de Entorno

Crear archivo `.env` en la ra√≠z del proyecto:

```env
# ===========================================
# CONFIGURACI√ìN B√ÅSICA (para Database y ADK Agent)
# ===========================================
GOOGLE_API_KEY=tu_api_key_aqui  # Obtener en: https://makersuite.google.com/app/apikey

# ===========================================
# CONFIGURACI√ìN DE VERTEX AI (solo para Vertex Agent)
# ===========================================
GOOGLE_CLOUD_PROJECT=tu_project_id
GOOGLE_CLOUD_LOCATION=us-central1
AGENT_ENGINE_ID=tu_agent_engine_id

# ===========================================
# CONFIGURACI√ìN DEL SERVIDOR
# ===========================================
SELECTED_AGENT=database  # database, adk, o vertex
AGENT_MODEL=gemini-2.0-flash
```

## üîß Configuraci√≥n por Agente

### 1. Database Agent (‚≠ê F√ÅCIL - 2 minutos)

**Paso 1: Obtener API Key**
1. Ve a [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Crea una nueva API Key
3. Copia la clave (formato: `AIzaSy...`)

**Paso 2: Configurar .env**
```env
GOOGLE_API_KEY=AIzaSy...
SELECTED_AGENT=database
```

**Paso 3: ¬°Ejecutar!**
```bash
python start_web.py --agent database
```

**‚úÖ Listo en 2 minutos** - Memoria persistente local funcionando

---

### 2. ADK Agent (‚≠ê‚≠ê INTERMEDIO - 3 minutos)

**Paso 1: Seguir configuraci√≥n del Database Agent**
- Usar la misma API Key de Google AI Studio

**Paso 2: Cambiar agente en .env**
```env
GOOGLE_API_KEY=AIzaSy...
SELECTED_AGENT=adk
```

**Paso 3: Ejecutar**
```bash
python start_web.py --agent adk
```

**‚úÖ Listo en 3 minutos** - Patr√≥n oficial ADK con memoria persistente

---

### 3. Vertex Agent (‚≠ê‚≠ê‚≠ê AVANZADO - 10 minutos)

**Paso 1: Instalar Google Cloud SDK**
```bash
# Descargar desde: https://cloud.google.com/sdk/docs/install
# Instalar y reiniciar terminal
```

**Paso 2: Configurar Google Cloud**
```bash
# Autenticarse
gcloud auth login

# Configurar proyecto (reemplaza TU_PROJECT_ID)
gcloud config set project TU_PROJECT_ID

# Configurar Application Default Credentials
gcloud auth application-default login

# Configurar quota project
gcloud auth application-default set-quota-project TU_PROJECT_ID
```

**Paso 3: Habilitar APIs**
```bash
# Habilitar Vertex AI API
gcloud services enable aiplatform.googleapis.com

# Verificar APIs habilitadas
gcloud services list --enabled
```

**Paso 4: Crear Agent Engine (Autom√°tico)**
```bash
# Ejecutar script de creaci√≥n autom√°tica
python create_agent_engine_vertex.py
```

**Este script hace todo autom√°ticamente:**
- ‚úÖ Verifica la configuraci√≥n de Google Cloud
- ‚úÖ Crea el Agent Engine en Vertex AI
- ‚úÖ Actualiza autom√°ticamente el archivo `.env`

**Paso 5: Configurar .env**
```env
# El script ya actualiza estas variables autom√°ticamente
GOOGLE_CLOUD_PROJECT=tu_project_id
GOOGLE_CLOUD_LOCATION=us-central1
AGENT_ENGINE_ID=el_id_generado_por_el_script
SELECTED_AGENT=vertex
```

**Paso 6: Verificar y Ejecutar**
```bash
# Verificar configuraci√≥n
python start_web.py --agent vertex --check

# Ejecutar servidor
python start_web.py --agent vertex
```

**‚úÖ Listo en 10 minutos** - Memoria persistente en Google Cloud con b√∫squeda sem√°ntica avanzada

## üöÄ Uso del Sistema

### Iniciar Servidor

```bash
# Usar agente espec√≠fico
python start_web.py --agent database    # F√°cil
python start_web.py --agent adk         # Intermedio  
python start_web.py --agent vertex      # Avanzado

# Con opciones personalizadas
python start_web.py --agent database --host 0.0.0.0 --port 8000

# Solo verificar configuraci√≥n
python start_web.py --agent database --check

# Ver informaci√≥n de todos los agentes
python start_web.py --info
```

### Acceder a la Interfaz Web

1. **Abrir navegador**: `http://localhost:8000`
2. **Interfaz de chat**: Interfaz web intuitiva con memoria persistente
3. **API REST**: Documentaci√≥n completa en `http://localhost:8000/docs`

### Funcionalidades de Memoria por Agente

#### Database Agent
- **Memoria Personal**: Extrae autom√°ticamente nombre, edad, preferencias
- **Historial Completo**: Guarda todas las conversaciones en SQLite
- **B√∫squeda Sem√°ntica**: Busca en conversaciones anteriores por palabras clave
- **Contexto Autom√°tico**: Incluye informaci√≥n relevante en cada respuesta

#### ADK Agent  
- **Patr√≥n Oficial**: Implementa exactamente la documentaci√≥n oficial del ADK
- **Herramienta load_memory**: Acceso autom√°tico a conversaciones pasadas
- **Gesti√≥n de Sesiones**: InMemorySessionService para sesiones persistentes
- **Memoria Inteligente**: InMemoryMemoryService para b√∫squedas autom√°ticas

#### Vertex Agent
- **B√∫squeda Sem√°ntica Avanzada**: Usa IA para encontrar informaci√≥n relevante
- **Memoria en la Nube**: Almacenamiento escalable en Google Cloud
- **Procesamiento Autom√°tico**: Extrae y organiza informaci√≥n autom√°ticamente
- **Escalabilidad**: Maneja grandes vol√∫menes de conversaciones

### Endpoints de la API

```bash
# Chat con el agente (memoria persistente autom√°tica)
POST /chat
{
  "user_id": "usuario123",
  "message": "Hola, ¬øc√≥mo est√°s?",
  "session_id": "opcional"
}

# Obtener informaci√≥n de memorias
GET /memories/{user_id}

# Estado del sistema y agente activo
GET /health

# Debug detallado de memoria (muy √∫til para desarrollo)
GET /debug/{user_id}
```

## üîç Soluci√≥n de Problemas

### Error: "GOOGLE_API_KEY no encontrada"

**Causa**: API Key no configurada

**Soluci√≥n**:
```bash
# 1. Obtener API Key en: https://makersuite.google.com/app/apikey
# 2. Agregar al archivo .env:
GOOGLE_API_KEY=AIzaSy...
```

### Error: "401 UNAUTHENTICATED" (Vertex Agent)

**Causa**: Problemas de autenticaci√≥n OAuth2

**Soluci√≥n**:
```bash
# Reconfigurar Google Cloud
gcloud auth application-default login
gcloud config set project TU_PROJECT_ID
gcloud auth application-default set-quota-project TU_PROJECT_ID
```

### Error: "Agent Engine ID is required"

**Causa**: No se ha creado el Agent Engine para Vertex Agent

**Soluci√≥n**:
```bash
# Ejecutar script autom√°tico
python create_agent_engine_vertex.py
```

### Error: "API keys are not supported by this API"

**Causa**: Usando API Key de Google AI Studio con Vertex AI

**Soluci√≥n**:
- Vertex Agent usa OAuth2, NO API Key
- Usar `gcloud auth application-default login`
- No configurar `GOOGLE_API_KEY` para Vertex Agent

### Error: "Content object has no attribute 'content'"

**Causa**: Problema de estructura de eventos (ya resuelto)

**Soluci√≥n**: Actualizar a la √∫ltima versi√≥n del c√≥digo

## üìä Comparaci√≥n Detallada de Agentes

| Caracter√≠stica | Database Agent | ADK Agent | Vertex Agent |
|----------------|----------------|-----------|--------------|
| **‚ö° Configuraci√≥n** | ‚≠ê F√°cil (2 min) | ‚≠ê‚≠ê Intermedio (3 min) | ‚≠ê‚≠ê‚≠ê Avanzado (10 min) |
| **üß† Memoria** | SQLite local completa | ADK InMemory oficial | Vertex AI Memory Bank |
| **üîç B√∫squeda** | Palabras clave b√°sica | Patr√≥n oficial ADK | Sem√°ntica avanzada con IA |
| **üíæ Persistencia** | Local (archivo .db) | Local (memoria ADK) | Nube (Google Cloud) |
| **üìä Escalabilidad** | Limitada (local) | Media (memoria) | Alta (nube) |
| **üí∞ Costo** | Gratis | Gratis | Pay-per-use |
| **üè≠ Producci√≥n** | ‚ùå Solo desarrollo | ‚ö†Ô∏è Limitado | ‚úÖ Recomendado |
| **üîß Herramientas** | load_memory integrada | load_memory oficial | load_memory autom√°tica |
| **üìù Extracci√≥n** | Autom√°tica (nombre, edad) | Autom√°tica (conversaciones) | Inteligente (IA) |
| **üåê Red** | No requiere | No requiere | Requiere Google Cloud |
| **‚öôÔ∏è Mantenimiento** | M√≠nimo | M√≠nimo | Autom√°tico |

## üèóÔ∏è Arquitectura del Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web Interface ‚îÇ    ‚îÇ   FastAPI Server ‚îÇ    ‚îÇ   Agent Manager ‚îÇ
‚îÇ   (HTML/JS)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (REST API)     ‚îÇ‚óÑ‚îÄ‚îÄ‚ñ∫‚îÇ   (Selector)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                         ‚îÇ
                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                       ‚îÇ                                 ‚îÇ                                 ‚îÇ
                       ‚ñº                                 ‚ñº                                 ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ Database Agent  ‚îÇ              ‚îÇ   ADK Agent     ‚îÇ              ‚îÇ  Vertex Agent   ‚îÇ
              ‚îÇ                 ‚îÇ              ‚îÇ                 ‚îÇ              ‚îÇ                 ‚îÇ
              ‚îÇ ‚Ä¢ SQLite DB     ‚îÇ              ‚îÇ ‚Ä¢ InMemory      ‚îÇ              ‚îÇ ‚Ä¢ Vertex AI     ‚îÇ
              ‚îÇ ‚Ä¢ Local Memory  ‚îÇ              ‚îÇ ‚Ä¢ ADK Services  ‚îÇ              ‚îÇ ‚Ä¢ Cloud Memory  ‚îÇ
              ‚îÇ ‚Ä¢ load_memory   ‚îÇ              ‚îÇ ‚Ä¢ load_memory   ‚îÇ              ‚îÇ ‚Ä¢ load_memory   ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìù Estructura del Proyecto (Simplificada para Demo)

```
ADK_memory/
‚îú‚îÄ‚îÄ multi_tool_agent/           # M√≥dulo principal de agentes
‚îÇ   ‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database_agent.py   # Database Agent (SQLite completo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adk_agent.py        # ADK Agent (patr√≥n oficial)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vertex_agent.py     # Vertex Agent (Google Cloud)
‚îÇ   ‚îî‚îÄ‚îÄ agent_manager.py        # Gestor de agentes
‚îú‚îÄ‚îÄ server_fastapi.py           # Servidor FastAPI con interfaz web
‚îú‚îÄ‚îÄ start_web.py               # Script de inicio principal
‚îú‚îÄ‚îÄ create_agent_engine_vertex.py # Creador autom√°tico de Agent Engine
‚îú‚îÄ‚îÄ requirements.txt           # Dependencias del proyecto
‚îú‚îÄ‚îÄ env.example               # Plantilla de configuraci√≥n
‚îî‚îÄ‚îÄ README.md                 # Documentaci√≥n completa
```

## üéØ Resumen de Funcionalidades

### ‚úÖ Lo que hace cada agente:

**Database Agent:**
- Extrae autom√°ticamente informaci√≥n personal (nombre, edad, preferencias)
- Guarda conversaciones completas en SQLite
- Busca en historial por palabras clave
- Incluye contexto relevante en cada respuesta

**ADK Agent:**
- Implementa el patr√≥n oficial del ADK al 100%
- Usa InMemorySessionService e InMemoryMemoryService
- Herramienta load_memory integrada autom√°ticamente
- Gesti√≥n de sesiones siguiendo documentaci√≥n oficial

**Vertex Agent:**
- B√∫squeda sem√°ntica avanzada con IA
- Memoria persistente en Google Cloud
- Procesamiento autom√°tico de informaci√≥n
- Escalabilidad autom√°tica para producci√≥n

### üöÄ Para empezar ahora mismo:

1. **M√°s f√°cil**: `python start_web.py --agent database`
2. **Intermedio**: `python start_web.py --agent adk`  
3. **Avanzado**: `python start_web.py --agent vertex`

**¬°Tu agente con memoria persistente estar√° funcionando en minutos!** üéâ
